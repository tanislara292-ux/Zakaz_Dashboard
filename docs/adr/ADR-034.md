# ADR-034: Боевой тест QTickets-интеграции на dev-среде

**Дата:** 2025-11-03
**Контекст:** Необходимо подтвердить работоспособность QTickets API интеграции в реальных условиях с боевыми токенами и зафиксировать полный трейс выполнения для передачи заказчику.

**Задача:** Прогнать боевой тест QTickets-интеграции на dev-среде, зафиксировать полный трейс API вызовов и загрузки данных в ClickHouse.

**Решение:**
1. Настроить dev-окружение для работы с боевыми токенами QTickets API
2. Выполнить прямые HTTP запросы к API endpoints для валидации доступности
3. Запустить загрузчик в продакшн режиме с расширенным логированием
4. Зафиксировать результаты загрузки данных в ClickHouse таблицы
5. Создать полный отчет с логами и метриками для заказчика

**Контракты данных:**
- Источник: QTickets REST API (orders, events endpoints)
- Приемник: ClickHouse таблицы stg_qtickets_api_orders_raw, fact_qtickets_sales_daily
- Период: Последние 720 часов (30 дней) для покрытия реальных продаж
- Формат логов: JSON + stdout/stderr логирование контейнера

**Риски:**
- API токены могут быть недействительными или с ограниченными правами
- QTickets API может возвращать пустые данные за проверяемый период
- Проблемы с сетевой доступностью API с dev-сервера
- Ошибки трансформации данных при загрузке в ClickHouse
- Несоответствие прав доступа пользователя etl_writer

**Тест-план:**
1. Подготовка окружения и проверка доступности API
2. Прямые HTTP запросы к orders/events endpoints
3. Запуск загрузчика с LOG_LEVEL=DEBUG
4. Валидация данных в ClickHouse таблицах
5. Сбор артефактов (логи, JSON ответы, SQL выборки)

**Критерии приёмки (DoD):**
- ✅ QTickets API отвечает на requests с боевыми токенами
- ✅ Загрузчик выполняется без критических ошибок
- ✅ Данные загружаются в stg_qtickets_api_orders_raw
- ✅ Агрегированные данные появляются в fact_qtickets_sales_daily
- ✅ meta_job_runs содержит записи о выполнении
- ✅ Собран полный пакет артефактов для передачи заказчику