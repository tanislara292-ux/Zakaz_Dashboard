<clickhouse>
  <users>
    <!-- Writer used by ingestion jobs. -->
    <etl_writer>
      <password>EtL2024!Strong#Pass</password>
      <networks>
        <ip>127.0.0.1</ip>
        <ip>::1</ip>
      </networks>
      <profile>etl_profile</profile>
      <quota>etl_quota</quota>
      <access_management>0</access_management>
    </etl_writer>

    
    <!-- Service user for backups. -->
    <backup_user>
      <password>Backup2024!Strong#Pass</password>
      <networks>
        <ip>127.0.0.1</ip>
        <ip>::1</ip>
      </networks>
      <profile>backup_profile</profile>
      <quota>backup_quota</quota>
      <access_management>0</access_management>
    </backup_user>

    <!-- Restricted admin profile with write access to all objects. -->
    <admin_min>
      <password>AdminMin2024!Strong#Pass</password>
      <networks>
        <ip>127.0.0.1</ip>
        <ip>::1</ip>
      </networks>
      <profile>admin_profile</profile>
      <quota>default</quota>
      <access_management>1</access_management>
    </admin_min>
  </users>

  <!-- Role definitions shared across service accounts. -->
  <roles>
    <role_etl_writer>
      <databases>
        <zakaz>
          <tables>
            <stg_qtickets_sales>
              <insert>1</insert>
              <select>1</select>
            </stg_qtickets_sales>
            <stg_vk_ads_daily>
              <insert>1</insert>
              <select>1</select>
            </stg_vk_ads_daily>
            <stg_sales_events>
              <insert>1</insert>
              <select>1</select>
            </stg_sales_events>
            <dm_sales_daily>
              <insert>1</insert>
              <select>1</select>
              <alter>1</alter>
            </dm_sales_daily>
            <dm_vk_ads_daily>
              <insert>1</insert>
              <select>1</select>
              <alter>1</alter>
            </dm_vk_ads_daily>
            <dim_city_alias>
              <insert>1</insert>
              <select>1</select>
            </dim_city_alias>
          </tables>
        </zakaz>
        <meta>
          <tables>
            <watermarks>
              <insert>1</insert>
              <select>1</select>
            </watermarks>
            <etl_runs>
              <insert>1</insert>
              <select>1</select>
            </etl_runs>
            <etl_alerts>
              <insert>1</insert>
              <select>1</select>
            </etl_alerts>
            <sli_daily>
              <insert>1</insert>
              <select>1</select>
            </sli_daily>
            <backup_runs>
              <insert>1</insert>
              <select>1</select>
            </backup_runs>
          </tables>
        </meta>
      </databases>
    </role_etl_writer>

    <role_bi_reader>
      <databases>
        <zakaz>
          <tables>*</tables>
        </zakaz>
        <bi>
          <tables>
            <v_sales_daily>
              <select>1</select>
            </v_sales_daily>
            <v_vk_ads_daily>
              <select>1</select>
            </v_vk_ads_daily>
            <v_marketing_roi_daily>
              <select>1</select>
            </v_marketing_roi_daily>
            <v_ops_freshness>
              <select>1</select>
            </v_ops_freshness>
          </tables>
        </bi>
        <meta>
          <tables>
            <v_sli_latest>
              <select>1</select>
            </v_sli_latest>
            <v_quality_last_day>
              <select>1</select>
            </v_quality_last_day>
          </tables>
        </meta>
      </databases>
    </role_bi_reader>

    <role_admin_min>
      <databases>
        <zakaz>
          <tables>*</tables>
        </zakaz>
        <bi>
          <tables>*</tables>
        </bi>
        <meta>
          <tables>*</tables>
        </meta>
      </databases>
      <system_databases>
        <tables>*</tables>
      </system_databases>
    </role_admin_min>
  </roles>

  <profiles>
    <etl_profile>
      <readonly>0</readonly>
      <allow_experimental_object_type>1</allow_experimental_object_type>
      <max_memory_usage>10000000000</max_memory_usage>
      <max_threads>4</max_threads>
      <max_execution_time>3600</max_execution_time>
    </etl_profile>

    <readonly_profile>
      <readonly>1</readonly>
      <max_memory_usage>2000000000</max_memory_usage>
      <max_threads>2</max_threads>
      <max_execution_time>300</max_execution_time>
    </readonly_profile>

    <backup_profile>
      <readonly>0</readonly>
      <allow_experimental_object_type>1</allow_experimental_object_type>
      <max_memory_usage>8000000000</max_memory_usage>
      <max_threads>6</max_threads>
      <max_execution_time>7200</max_execution_time>
    </backup_profile>

    <admin_profile>
      <readonly>0</readonly>
      <allow_experimental_object_type>1</allow_experimental_object_type>
      <max_memory_usage>16000000000</max_memory_usage>
      <max_threads>8</max_threads>
    </admin_profile>
  </profiles>

  <quotas>
    <etl_quota>
      <interval>
        <duration>3600</duration>
        <queries>1000</queries>
        <errors>100</errors>
        <result_rows>10000000</result_rows>
        <read_rows>100000000</read_rows>
        <execution_time>3600</execution_time>
      </interval>
    </etl_quota>

    <backup_quota>
      <interval>
        <duration>7200</duration>
        <queries>10</queries>
        <errors>5</errors>
        <result_rows>0</result_rows>
        <read_rows>0</read_rows>
        <execution_time>7200</execution_time>
      </interval>
    </backup_quota>
  </quotas>
</clickhouse>
