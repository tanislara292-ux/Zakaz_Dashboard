# Дашборд: Sales Overview

## Обзор

Дашборд для анализа продаж с возможностью фильтрации по периоду, городам и мероприятиям.

## Источники данных

- **Основной датасет:** `ds_sales_daily`
- **Источник:** `bi.v_sales_daily`

## Фильтры дашборда

1. **Период (Date Range)**
   - Поле: `d`
   - Тип: Диапазон дат
   - Значение по умолчанию: последние 30 дней
   - Обязательный: Да

2. **Город (Multi-select)**
   - Поле: `city`
   - Тип: Мультиселект
   - Значение по умолчанию: все города
   - Обязательный: Нет

3. **Мероприятие (Multi-select)**
   - Поле: `event_id`
   - Тип: Мультиселект
   - Значение по умолчанию: все мероприятия
   - Обязательный: Нет

## KPI-виджеты

### 1. Revenue
- **Тип:** Текст/индикатор
- **Заголовок:** Выручка
- **Формула:** `SUM(revenue)`
- **Формат:** #,##0.00 ₽
- **Цвет:** Синий
- **Позиция:** верхний левый

### 2. Tickets
- **Тип:** Текст/индикатор
- **Заголовок:** Продано билетов
- **Формула:** `SUM(tickets_sold)`
- **Формат:** #,##0
- **Цвет:** Зеленый
- **Позиция:** верхний центр

### 3. Avg Ticket
- **Тип:** Текст/индикатор
- **Заголовок:** Средний чек
- **Формула:** `SUM(revenue) / NULLIF(SUM(tickets_sold), 0)`
- **Формат:** #,##0.00 ₽
- **Цвет:** Оранжевый
- **Позиция:** верхний правый

## Визуализации

### 1. Динамика выручки (Линия)
- **Тип:** Линейный график
- **Заголовок:** Выручка по дням
- **Ось X:** `d` (дата)
- **Ось Y:** `SUM(revenue)`
- **Цвет:** Синий
- **Позиция:** средний левый
- **Размер:** 2x1

### 2. Топ городов по выручке (Столбцы)
- **Тип:** Столбчатая диаграмма
- **Заголовок:** Топ-20 городов по выручке
- **Ось X:** `city`
- **Ось Y:** `SUM(revenue)`
- **Сортировка:** по убыванию
- **Лимит:** 20
- **Цвет:** Зеленый
- **Позиция:** средний правый
- **Размер:** 2x1

### 3. Детализация продаж (Таблица)
- **Тип:** Таблица
- **Заголовок:** Детализация по продажам
- **Колонки:**
  - `d` (Дата)
  - `city` (Город)
  - `event_id` (ID мероприятия)
  - `tickets_sold` (Продано билетов)
  - `revenue` (Выручка)
  - `avg_ticket` (Средний чек)
- **Сортировка:** по дате (убывание), затем по выручке (убывание)
- **Пагинация:** 20 строк
- **Позиция:** нижний
- **Размер:** 4x2

## Взаимодействия

1. **При выборе периода:**
   - Обновляются все виджеты
   - KPI пересчитываются за выбранный период

2. **При выборе города/городов:**
   - Фильтруются все виджеты
   - Топ городов обновляется с учетом фильтра

3. **При выборе мероприятия:**
   - Фильтруются все виджеты
   - Показываются данные только по выбранным мероприятиям

## Параметры обновления

- **Автообновление:** 15 минут
- **Кэширование:** 10 минут
- **Таймзона:** Europe/Moscow

## Расположение виджетов

```
┌─────────────┬─────────────┬─────────────┐
│   Revenue   │   Tickets   │ Avg Ticket  │
│   (1x1)      │   (1x1)      │   (1x1)      │
├─────────────┼─────────────┤             │
│ Динамика     │ Топ городов │             │
│ выручки      │ по выручке  │             │
│   (2x1)      │   (2x1)      │             │
├─────────────────────────────┤             │
│        Детализация         │             │
│        продаж (4x2)        │             │
└─────────────────────────────┴─────────────┘
```

## Экспорт

- **ID дашборда:** (заполняется после создания)
- **JSON экспорт:** `bi/exports/sales_overview.json`
- **Последнее обновление:** (заполняется после создания)