# Дашборд: Marketing ROI

## Обзор

Дашборд для анализа эффективности маркетинговых вложений и возврата инвестиций (ROI).

## Источники данных

- **Основной датасет:** `ds_roi_daily`
- **Источник:** `bi.v_marketing_roi_daily`

## Фильтры дашборда

1. **Период (Date Range)**
   - Поле: `d`
   - Тип: Диапазон дат
   - Значение по умолчанию: последние 30 дней
   - Обязательный: Да

2. **Город (Multi-select)**
   - Поле: `city`
   - Тип: Мультиселект
   - Значение по умолчанию: все города
   - Обязательный: Нет

## KPI-виджеты

### 1. ROAS
- **Тип:** Текст/индикатор
- **Заголовок:** ROAS
- **Формула:** `SUM(revenue) / NULLIF(SUM(spend), 0)`
- **Формат:** #,##0.00x
- **Цвет:** Синий
- **Позиция:** верхний левый

### 2. Spend
- **Тип:** Текст/индикатор
- **Заголовок:** Расходы на рекламу
- **Формула:** `SUM(spend)`
- **Формат:** #,##0.00 ₽
- **Цвет:** Красный
- **Позиция:** верхний центр

### 3. Revenue from Ads
- **Тип:** Текст/индикатор
- **Заголовок:** Выручка от рекламы
- **Формула:** `SUM(revenue)`
- **Формат:** #,##0.00 ₽
- **Цвет:** Зеленый
- **Позиция:** верхний правый

### 4. CPC
- **Тип:** Текст/индикатор
- **Заголовок:** CPC
- **Формула:** `SUM(spend) / NULLIF(SUM(clicks), 0)`
- **Формат:** #,##0.00 ₽
- **Цвет:** Оранжевый
- **Позиция:** верхний левый (второй ряд)

### 5. CPT
- **Тип:** Текст/индикатор
- **Заголовок:** CPT
- **Формула:** `SUM(spend) / NULLIF(SUM(tickets_sold), 0)`
- **Формат:** #,##0.00 ₽
- **Цвет:** Фиолетовый
- **Позиция:** верхний центр (второй ряд)

## Визуализации

### 1. Выручка vs Расходы (Комбо-график)
- **Тип:** Комбо-график
- **Заголовок:** Выручка и расходы на рекламу
- **Ось X:** `d` (дата)
- **Левая ось Y:** `SUM(revenue)` (линия, синий)
- **Правая ось Y:** `SUM(spend)` (столбцы, красный)
- **Позиция:** средний левый
- **Размер:** 2x1

### 2. Динамика ROAS (Линия)
- **Тип:** Линейный график
- **Заголовок:** ROAS по дням
- **Ось X:** `d` (дата)
- **Ось Y:** `AVG(roas)`
- **Цвет:** Зеленый
- **Позиция:** средний правый
- **Размер:** 2x1

### 3. Топ городов по ROAS (Столбцы)
- **Тип:** Столбчатая диаграмма
- **Заголовок:** Топ-10 городов по ROAS
- **Ось X:** `city`
- **Ось Y:** `AVG(roas)`
- **Сортировка:** по убыванию
- **Лимит:** 10
- **Цвет:** Синий
- **Позиция:** средний левый (нижний ряд)
- **Размер:** 2x1

### 4. Расходы vs Выручка (Точечная диаграмма)
- **Тип:** Точечная диаграмма
- **Заголовок:** Эффективность по городам
- **Ось X:** `SUM(spend)`
- **Ось Y:** `SUM(revenue)`
- **Размер точек:** `SUM(tickets_sold)`
- **Цвет:** по ROAS (градиент)
- **Позиция:** средний правый (нижний ряд)
- **Размер:** 2x1

### 5. Детализация ROI (Таблица)
- **Тип:** Таблица
- **Заголовок:** Детализация по ROI
- **Колонки:**
  - `d` (Дата)
  - `city` (Город)
  - `revenue` (Выручка)
  - `spend` (Расходы)
  - `roas` (ROAS)
  - `cpc` (CPC)
  - `cpt` (CPT)
  - `tickets_sold` (Продано билетов)
  - `clicks` (Клики)
  - `impressions` (Показы)
- **Сортировка:** по дате (убывание), затем по ROAS (убывание)
- **Пагинация:** 20 строк
- **Позиция:** нижний
- **Размер:** 4x2

## Взаимодействия

1. **При выборе периода:**
   - Обновляются все виджеты
   - KPI пересчитываются за выбранный период

2. **При выборе города/городов:**
   - Фильтруются все виджеты
   - Топ городов обновляется с учетом фильтра

3. **При клике на город в топе:**
   - Фильтруется весь дашборд по выбранному городу
   - Обновляются все виджеты

## Параметры обновления

- **Автообновление:** 15 минут
- **Кэширование:** 10 минут
- **Таймзона:** Europe/Moscow

## Расположение виджетов

```
┌─────────────┬─────────────┬─────────────┐
│    ROAS     │    Spend    │   Revenue   │
│    (1x1)     │    (1x1)     │    (1x1)     │
├─────────────┼─────────────┼─────────────┤
│     CPC     │     CPT     │             │
│    (1x1)     │    (1x1)     │             │
├─────────────────────────────┤             │
│ Выручка vs  │ Динамика     │             │
│ Расходы     │ ROAS         │             │
│   (2x1)      │   (2x1)      │             │
├─────────────────────────────┤             │
│ Топ городов │ Эффективность│             │
│ по ROAS     │ по городам   │             │
│   (2x1)      │   (2x1)      │             │
├─────────────────────────────┤             │
│        Детализация         │             │
│        ROI (4x2)           │             │
└─────────────────────────────┴─────────────┘
```

## Экспорт

- **ID дашборда:** (заполняется после создания)
- **JSON экспорт:** `bi/exports/marketing_roi.json`
- **Последнее обновление:** (заполняется после создания)