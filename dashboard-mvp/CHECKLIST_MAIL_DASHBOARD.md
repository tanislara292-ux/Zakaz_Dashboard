# –ß–µ–∫–ª–∏—Å—Ç —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –ø–æ—á—Ç–æ–≤–æ–≥–æ –¥–∞—à–±–æ—Ä–¥–∞

## ‚úÖ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

- [ ] ClickHouse –∑–∞–ø—É—â–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω
- [ ] Caddy –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è HTTPS –ø—Ä–æ–∫—Å–∏
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ `etl_writer` –∏ `datalens_reader` —Å–æ–∑–¥–∞–Ω—ã

## ‚úÖ DDL –∏ —Ç–∞–±–ª–∏—Ü—ã

- [ ] –§–∞–π–ª `infra/clickhouse/init_mail.sql` —Å–æ–∑–¥–∞–Ω
- [ ] –¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã —á–µ—Ä–µ–∑ `clickhouse-client --multiquery < init_mail.sql`
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ: `SHOW TABLES FROM zakaz LIKE '%sales%'`

## ‚úÖ –ü–æ—á—Ç–æ–≤—ã–π –∏–Ω–∂–µ—Å—Ç–æ—Ä

- [ ] –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `mail-python/` —Å–æ–∑–¥–∞–Ω–∞
- [ ] `requirements.txt` —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ —Å–æ–∑–¥–∞–Ω
- [ ] `gmail_ingest.py` —Å –ª–æ–≥–∏–∫–æ–π –∏–Ω–∂–µ—Å—Ç–æ—Ä–∞ —Å–æ–∑–¥–∞–Ω
- [ ] `.env.sample` —à–∞–±–ª–æ–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω
- [ ] –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `secrets/gmail/` —Å–æ–∑–¥–∞–Ω–∞
- [ ] –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ Python —Å–æ–∑–¥–∞–Ω–æ: `python3 -m venv .venv`
- [ ] –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã: `pip install -r requirements.txt`
- [ ] `.env` —Ñ–∞–π–ª —Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω

## ‚úÖ Gmail API

- [ ] –ü—Ä–æ–µ–∫—Ç –≤ Google Cloud Console —Å–æ–∑–¥–∞–Ω
- [ ] Gmail API –≤–∫–ª—é—á–µ–Ω
- [ ] OAuth 2.0 Client ID (Desktop) —Å–æ–∑–¥–∞–Ω
- [ ] `credentials.json` —Å–∫–∞—á–∞–Ω –≤ `mail-python/secrets/gmail/`
- [ ] –¢–µ—Å—Ç–æ–≤–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–æ–π–¥–µ–Ω–∞: `python gmail_ingest.py --dry-run --limit 1`

## ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

- [ ] `gmail-ingest.service` —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ `/etc/systemd/system/`
- [ ] `gmail-ingest.timer` —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ `/etc/systemd/system/`
- [ ] Systemd –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω: `systemctl daemon-reload`
- [ ] –¢–∞–π–º–µ—Ä –≤–∫–ª—é—á–µ–Ω: `systemctl enable --now gmail-ingest.timer`
- [ ] –°—Ç–∞—Ç—É—Å –ø—Ä–æ–≤–µ—Ä–µ–Ω: `systemctl list-timers | grep gmail-ingest`

## ‚úÖ DataLens

- [ ] –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö ClickHouse —Å–æ–∑–¥–∞–Ω
- [ ] –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ `zakaz` –±–∞–∑–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
- [ ] –î–∞—Ç–∞—Å–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ `v_sales_combined` —Å–æ–∑–¥–∞–Ω
- [ ] –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ
- [ ] –ë–∞–∑–æ–≤—ã–π –¥–∞—à–±–æ—Ä–¥ —Å–æ–∑–¥–∞–Ω

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### ClickHouse
```bash
# –°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
clickhouse-client -q "SELECT count() FROM zakaz.stg_mail_sales_raw"

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ
clickhouse-client -q "SELECT * FROM zakaz.v_sales_14d ORDER BY d DESC LIMIT 5"

# –û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
clickhouse-client -q "SELECT count() FROM zakaz.v_sales_combined WHERE event_date >= today() - 7"
```

### Systemd
```bash
# –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞
systemctl status gmail-ingest.timer

# –õ–æ–≥–∏
journalctl -u gmail-ingest.service -n 20

# –ê–∫—Ç–∏–≤–Ω—ã–µ —Ç–∞–π–º–µ—Ä—ã
systemctl list-timers | grep gmail
```

### Python
```bash
cd mail-python
source .venv/bin/activate

# –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫
python gmail_ingest.py --dry-run --limit 3

# –ü–æ–ª–Ω—ã–π –∑–∞–ø—É—Å–∫
python gmail_ingest.py
```

## üö® –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∏–∑ Gmail
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `credentials.json` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `token.json` —Å–æ–∑–¥–∞–Ω –ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `GMAIL_QUERY` –≤ `.env`
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é —Å `--dry-run`

### –ü—Ä–æ–±–ª–µ–º—ã —Å ClickHouse
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ: `clickhouse-client --query "SELECT 1"`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞: `SHOW GRANTS FOR etl_writer`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü: `SHOW TABLES FROM zakaz`

### –ü—Ä–æ–±–ª–µ–º—ã —Å DataLens
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ `datalens_reader`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å HTTPS –ø—Ä–æ–∫—Å–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ç–µ–≤—É—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

- [ ] –ò–Ω–∂–µ—Å—Ç–æ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç
- [ ] –î–∞–Ω–Ω—ã–µ –∏–∑ –ø–æ—á—Ç—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ ClickHouse
- [ ] –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç (–Ω–µ—Ç –¥—É–±–ª–µ–π –≤ `v_sales_latest`)
- [ ] DataLens –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- [ ] –î–∞—à–±–æ—Ä–¥ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ freshness –¥–∞–Ω–Ω—ã—Ö
2. –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–∞–Ω–Ω—ã—Ö
3. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤
4. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
5. –î–æ–±–∞–≤–ª–µ–Ω–∏–µÊõ¥Â§ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö

---

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É:** [ ] –î–∞ / [ ] –ù–µ—Ç

**–î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:** ___________

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π:** ___________