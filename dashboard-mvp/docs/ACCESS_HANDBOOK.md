# Руководство по доступам

## 1. Google Sheets / DataLens
1. В GCP создайте Service Account `zakaz-dashboard-sa` (Project: `zakaz-dashboard-prod`).
2. Скачайте JSON-ключ и сохраните его в `secrets/google-sa.json` (папка уже скрыта `.gitignore`).
3. Добавьте сервис-аккаунт в Google Sheets `BI_Central` с ролью **Editor**.
4. Предоставьте совместный доступ маркетингу и аналитикам (только просмотр).
5. Для DataLens: передайте сервис-аккаунт заказчику; они добавят его в DataLens с ролью `editor`. Письмо-запрос — шаблон `ops/EMAIL_TEMPLATES.md#1`.

## 2. VK Ads API
1. На стороне клиента сгенерируйте user access token с правами `ads,offline`.
2. Для агентского кабинета добавьте `VK_CLIENT_ID` (agency) и `VK_ACCOUNT_ID` (account).
3. Токен хранится в `.env` (`VK_ACCESS_TOKEN`), доступ к файлу имеют только техлид и DevOps.
4. Ротация токена — раз в 90 дней; ответственный фиксируется в риск-логе (R3).

## 3. Управление секретами
- Рабочая копия `.env` хранится только локально и в CI Secrets (GitHub Actions `VK_ACCESS_TOKEN`, `GOOGLE_SA_JSON`).
- Передача секретов между участниками — только через корпоративный Secret Manager (`https://vault.zakaz.example`).
- JSON-ключи запрещено отправлять по почте / мессенджерам; допускается шифрование PGP.

## 4. Access-review чек-лист (ежемесячно)
1. Проверьте список пользователей в `BI_Central` и DataLens (лишние → revoke).
2. Сравните список сотрудников с актуальной орг-структурой Zakaz.
3. Убедитесь, что GitHub-репозиторий имеет MFA для всех контрибьюторов.
4. Обновите пароль сервис-аккаунта в Secret Manager, если обнаружены подозрительные активности.

## 5. Инциденты
- При компрометации токена VK — немедленно отозвать (https://vk.com/dev/access_token).
- При утечке Google JSON — отключить ключ, создать новый, обновить CI-секреты.
- Пост-инцидент: заполнить чек-лист в `ops/EMAIL_TEMPLATES.md` пункт «инцидент-репорт».
